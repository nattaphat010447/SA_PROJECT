<template>
  <div class="min-h-screen bg-gray-100 flex justify-center items-center p-4">
    <div class="bg-white text-gray-800 w-full max-w-md rounded-3xl overflow-hidden shadow-2xl p-6 relative">
      
      <div class="flex justify-between mb-6 gap-1">
        <div v-for="i in 5" :key="i" class="h-2 flex-1 rounded-full transition-all duration-300"
             :class="step >= i ? 'bg-blue-600' : 'bg-gray-200'"></div>
      </div>

      <div v-if="errorMessage" class="bg-red-100 text-red-600 p-3 rounded-lg mb-4 text-sm text-center font-semibold">
        {{ errorMessage }}
      </div>

      <div v-if="step === 1" class="animate-fade-in">
        <h2 class="text-2xl font-bold mb-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
        <p class="text-gray-500 text-sm mb-6">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        
        <div class="flex flex-col gap-4">
          <div>
            <label class="block text-sm font-semibold mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
            <input v-model="form.name" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ó‡∏û‡∏ã‡πà‡∏≤007" class="w-full border rounded-xl p-3 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" />
          </div>
          <div>
            <label class="block text-sm font-semibold mb-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
            <input v-model="form.email" type="email" placeholder="example@kkumail.com" class="w-full border rounded-xl p-3 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" />
          </div>
          <div>
            <label class="block text-sm font-semibold mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
            <input v-model="form.password" type="password" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô 6 ‡∏ï‡∏±‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ" class="w-full border rounded-xl p-3 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" />
          </div>
        </div>
      </div>

      <div v-if="step === 2" class="animate-fade-in">
        <h2 class="text-2xl font-bold mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h2>
        <p class="text-gray-500 text-sm mb-6">‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î</p>
        
        <div class="flex flex-col gap-4">
          <div>
            <label class="block text-sm font-semibold mb-1">‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)</label>
            <input v-model="form.age" type="number" placeholder="‡πÄ‡∏ä‡πà‡∏ô 20" class="w-full border rounded-xl p-3 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" />
          </div>
          <div>
            <label class="block text-sm font-semibold mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label>
            <input v-model="form.country" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô, ‡πÑ‡∏ó‡∏¢" class="w-full border rounded-xl p-3 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" />
          </div>
        </div>
      </div>

      <div v-if="step === 3" class="animate-fade-in">
        <h2 class="text-2xl font-bold mb-2">‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö‡πÄ‡∏•‡πà‡∏ô</h2>
        <p class="text-gray-500 text-sm mb-6">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡πÄ‡∏Å‡∏°)</p>
        
        <div class="flex flex-col gap-3">
          <label v-for="game in availableGames" :key="game.id" 
                 class="flex items-center p-4 border-2 rounded-xl cursor-pointer transition-all"
                 :class="form.games.includes(game.id) ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-gray-200 hover:bg-gray-50'">
            
            <input type="checkbox" 
                   v-model="form.games" 
                   :value="game.id" 
                   class="w-5 h-5 text-blue-600 bg-white border-gray-300 rounded focus:ring-blue-500 focus:ring-2 cursor-pointer mr-3" />
            
            <span class="font-semibold">{{ game.name }}</span>
          </label>
        </div>
      </div>

      <div v-if="step === 4" class="animate-fade-in">
        <h2 class="text-2xl font-bold mb-2">‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏∏‡∏ì (Bio)</h2>
        <p class="text-gray-500 text-sm mb-6">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏à‡πã‡∏á‡πÜ ‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏µ‡∏°‡∏´‡∏ô‡πà‡∏≠‡∏¢!</p>
        
        <textarea v-model="form.bio" rows="5" 
                  placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏•‡πà‡∏ô‡∏ä‡∏¥‡∏ß‡πÜ ‡πÑ‡∏°‡πà‡∏´‡∏±‡∏ß‡∏£‡πâ‡∏≠‡∏ô" 
                  class="w-full border rounded-xl p-3 bg-gray-50 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
      </div>

      <div v-if="step === 5" class="animate-fade-in">
        <h2 class="text-2xl font-bold mb-2">‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 9 ‡∏£‡∏π‡∏õ)</h2>
        <p class="text-gray-500 text-sm mb-6">‡∏£‡∏π‡∏õ‡πÅ‡∏£‡∏Å‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î)</p>
        
        <input type="file" ref="fileInput" class="hidden" accept="image/*" @change="handleFileUpload" />

        <div class="grid grid-cols-3 gap-2">
          <div v-for="index in 9" :key="index" 
               @click="triggerUpload(index - 1)"
               class="group aspect-square bg-gray-100 border-2 border-dashed border-gray-300 rounded-xl flex items-center justify-center cursor-pointer hover:bg-gray-200 transition relative overflow-hidden">
            
            <img v-if="imagePreviews[index - 1]" :src="imagePreviews[index - 1]" class="w-full h-full object-cover" />
            <span v-else class="text-gray-400 text-2xl">+</span>

            <button v-if="imagePreviews[index - 1]" 
                    @click.stop="removePhoto(index - 1)" 
                    class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition shadow-md hover:bg-red-600">
              ‚úï
            </button>
          </div>
        </div>
        
        <div v-if="isSubmitting" class="mt-4 text-center text-sm text-blue-600 font-semibold animate-pulse">
          ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...
        </div>
      </div>

      <div class="flex justify-between mt-8 pt-4 border-t">
        <button v-if="step > 1" @click="step--" :disabled="isSubmitting" class="text-gray-500 font-bold py-3 px-6 rounded-xl hover:bg-gray-100 transition disabled:opacity-50">
          ‡∏Å‡∏•‡∏±‡∏ö
        </button>
        <div v-else>
          <router-link to="/" class="text-gray-500 font-bold py-3 px-6 rounded-xl hover:bg-gray-100 transition inline-block">
            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
          </router-link>
        </div> 

        <button v-if="step < 5" @click="nextStep" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:bg-blue-700 transition">
          ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        </button>
        
        <button v-if="step === 5" @click="finishRegister" :disabled="isSubmitting" 
                class="bg-green-600 text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:bg-green-700 transition disabled:opacity-50">
          {{ isSubmitting ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!' }}
        </button>
      </div>

    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { useRouter } from 'vue-router';
import api from '../api';

const router = useRouter();
const step = ref(1);
const errorMessage = ref('');
const isSubmitting = ref(false);

const availableGames = ref<any[]>([]);

const form = ref({
  name: '',
  email: '',
  password: '',
  age: '',
  country: '',
  bio: '',
  games: [] as number[],
});

// ==========================================
// üéÆ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Å‡∏°
// ==========================================
/*
const toggleGame = (gameId: number) => {
  const index = form.value.games.indexOf(gameId);
  if (index > -1) {
    form.value.games.splice(index, 1);
  } else {
    form.value.games.push(gameId);
  }
};
*/

onMounted(async () => {
  try {
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°‡∏à‡∏≤‡∏Å Backend
    const res = await api.get('/profile/all-games');
    // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà UI ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô‡πÉ‡∏ä‡πâ game_name ‡πÅ‡∏ó‡∏ô name)
    availableGames.value = res.data.map((g: any) => ({
      id: g.id,
      name: g.game_name
    }));
  } catch (err) {
    console.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ', err);
  }
});

// ==========================================
// üì∏ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Preview & Store Local)
// ==========================================
const fileInput = ref<HTMLInputElement | null>(null);
let currentIndexToUpload = 0;

// ‡πÄ‡∏Å‡πá‡∏ö File object ‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡πÑ‡∏ß‡πâ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏¢‡∏¥‡∏á API ‡∏ï‡∏≠‡∏ô‡∏à‡∏ö
const imageFiles = ref<Array<File | null>>(new Array(9).fill(null));
// ‡πÄ‡∏Å‡πá‡∏ö URL ‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (blob) ‡πÑ‡∏ß‡πâ‡πÇ‡∏ä‡∏ß‡πå‡πÉ‡∏´‡πâ User ‡∏î‡∏π
const imagePreviews = ref<Array<string>>(new Array(9).fill(''));

const triggerUpload = (index: number) => {
  if (isSubmitting.value) return; // ‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡∏ï‡∏≠‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î
  currentIndexToUpload = index;
  fileInput.value?.click();
};

const handleFileUpload = (event: Event) => {
  const target = event.target as HTMLInputElement;
  const file = target.files?.[0];
  if (!file) return;

  // ‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏¥‡πâ‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏™‡πà‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà
  if (imagePreviews.value[currentIndexToUpload]) {
    URL.revokeObjectURL(imagePreviews.value[currentIndexToUpload]);
  }

  // ‡πÄ‡∏ã‡∏ü‡∏•‡∏á State 
  imageFiles.value[currentIndexToUpload] = file;
  imagePreviews.value[currentIndexToUpload] = URL.createObjectURL(file);

  target.value = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå input
};

const removePhoto = (index: number) => {
  if (isSubmitting.value) return;
  
  // ‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥
  if (imagePreviews.value[index]) {
    URL.revokeObjectURL(imagePreviews.value[index]);
  }
  
  // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å State
  imageFiles.value[index] = null;
  imagePreviews.value[index] = '';
};

// ==========================================
// ‚û°Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
// ==========================================
const nextStep = () => {
  errorMessage.value = '';
  
  if (step.value === 1) {
    if (!form.value.name || !form.value.email || !form.value.password) {
      errorMessage.value = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô';
      return;
    }
  } 
  
  step.value++;
};

const finishRegister = async () => {
  try {
    errorMessage.value = '';
    isSubmitting.value = true;

    // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Account
    await api.post('/auth/register', {
      name: form.value.name,
      email: form.value.email,
      password: form.value.password
    });

    // 2. ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤ Token ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏ï‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ
    const loginRes = await api.post('/auth/login', {
      email: form.value.email,
      password: form.value.password
    });
    const token = loginRes.data.token;
    localStorage.setItem('token', token);

    // 3. ‡∏ó‡∏¢‡∏≠‡∏¢‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏Ç‡∏∂‡πâ‡∏ô Cloudinary (‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå)
    const uploadedUrls: string[] = [];
    
    for (let i = 0; i < imageFiles.value.length; i++) {
      const file = imageFiles.value[i];
      if (file) {
        const formData = new FormData();
        formData.append('image', file);
        
        // ‡∏¢‡∏¥‡∏á API ‡πÇ‡∏î‡∏¢‡πÅ‡∏ô‡∏ö Token ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢ 
        const uploadRes = await api.post('/upload', formData, {
          headers: { 
            'Content-Type': 'multipart/form-data',
            'Authorization': `Bearer ${token}` 
          }
        });
        
        uploadedUrls.push(uploadRes.data.imageUrl);
      }
    }

    // 4. ‡πÄ‡∏ã‡∏ü Profile ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
    await api.put('/profile', {
      display_name: form.value.name,
      bio: form.value.bio,
      age: Number(form.value.age) || 0,
      country: form.value.country,
      profile_images: uploadedUrls // ‡∏™‡πà‡∏á Array ‡∏Ç‡∏≠‡∏á URL ‡πÑ‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
    }, {
      headers: { 'Authorization': `Bearer ${token}` } // ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÅ‡∏ô‡∏ö Token
    });

    // 5. ‡πÄ‡∏ã‡∏ü Games ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    for (const gameId of form.value.games) {
      await api.post('/profile/games', { gameId }, {
        headers: { 'Authorization': `Bearer ${token}` }
      });
    }

    // ‡∏•‡πâ‡∏≤‡∏á Memory ‡∏ó‡∏¥‡πâ‡∏á‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
    imagePreviews.value.forEach(url => {
      if (url) URL.revokeObjectURL(url);
    });

    alert('‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö üöÄ');
    router.push('/home'); 

  } catch (err: any) {
    console.error(err);
    errorMessage.value = err.response?.data?.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
    
    if (errorMessage.value.includes('exists') || errorMessage.value.includes('already')) {
      step.value = 1; 
    }
  } finally {
    isSubmitting.value = false;
  }
};
</script>

<style scoped>
.animate-fade-in {
  animation: fadeIn 0.4s ease-in-out;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(15px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>